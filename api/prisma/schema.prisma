generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model UserModel {
  id           Int      @id @default(autoincrement())
  name         String   @db.VarChar(255)
  email        String   @db.VarChar(255)
  password     String   @db.VarChar(255)
  createdAt    DateTime @default(now())

  shortLinks   ShortLinkModel[]

  @@unique([email])
  @@index([email])
  @@map("users")
}

model ShortLinkModel {
  id          Int      @id @default(autoincrement())
  userId      Int
  originalUrl String   @db.Text
  shortCode   String   @db.VarChar(16)
  createdAt   DateTime @default(now())
  isActive    Boolean  @default(true)

  user        UserModel @relation(fields: [userId], references: [id], onDelete: Cascade)
  clickEvents ClickEventModel[]

  @@unique([shortCode])
  @@index([userId, isActive])
  @@index([userId])
  @@index([isActive])
  @@map("short_links")
}

model ClickEventModel {
  id          Int      @id @default(autoincrement())
  shortLinkId Int
  ip          String   @db.VarChar(45)   // IPv4 + IPv6
  userAgent   String   @db.Text
  createdAt   DateTime @default(now())

  shortLink   ShortLinkModel @relation(fields: [shortLinkId], references: [id], onDelete: Cascade)

  @@index([shortLinkId])
  @@index([createdAt])
  @@map("click_events")
}